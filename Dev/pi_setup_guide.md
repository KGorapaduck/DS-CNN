# ğŸ“ ë¼ì¦ˆë² ë¦¬íŒŒì´ 3 B+ KWS ì„¸íŒ… ê°€ì´ë“œ (Phase 2)

PCì—ì„œ ì„±ê³µì ìœ¼ë¡œ ê²€ì¦ëœ KWS(Keyword Spotting) íŒŒì´í”„ë¼ì¸ì„ ë¼ì¦ˆë² ë¦¬íŒŒì´ì— ì´ì‹í•˜ê¸° ìœ„í•œ ì™„ë²½í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. 

ìš°ë¦¬ê°€ ë§Œë“  ëª¨ë¸ì€ í•™ìŠµ ì‹œ TensorFlow 1.15ì˜ ë‚´ì¥ C++ ëª¨ë“ˆ(`contrib_audio`)ì„ ì‚¬ìš©í•˜ì—¬ ì˜¤ë””ì˜¤ íŠ¹ì§•(MFCC)ì„ ì¶”ì¶œí–ˆìŠµë‹ˆë‹¤. ì´ ì—°ì‚°ì€ í‘œì¤€ TFLite ëŸ°íƒ€ì„ì— í˜¸í™˜ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë¼ì¦ˆë² ë¦¬íŒŒì´ì—ë„ ê°€ë²¼ìš´ **ì„ë² ë””ë“œìš© TensorFlow 1.15**ë¥¼ ì„¤ì¹˜í•´ì•¼ ì™„ë²½í•˜ê²Œ ë™ì¼í•œ ì„±ëŠ¥ì„ ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 1ë‹¨ê³„: ë¼ì¦ˆë² ë¦¬íŒŒì´ OS ì„¤ì¹˜ ë° ì´ˆê¸° ì„¤ì •
TensorFlow 1.15 ì‚¬ì „ ë¹Œë“œ ë²„ì „ê³¼ í˜¸í™˜ë˜ëŠ” **Python 3.7** í™˜ê²½ì„ ë§ì¶”ê¸° ìœ„í•´, ë°˜ë“œì‹œ **Legacy (Buster)** ë²„ì „ì„ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

1. PCì—ì„œ **Raspberry Pi Imager** í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
2. **[ìš´ì˜ì²´ì œ ì„ íƒ]** -> **[Raspberry Pi OS (Other)]** í´ë¦­
3. **[Raspberry Pi OS (Legacy, 32-bit)]** (Debian Buster ê¸°ë°˜)ì„ ì„ íƒí•©ë‹ˆë‹¤.
4. ì„¤ì¹˜ ì „ í†±ë‹ˆë°”í€´(ì„¤ì •) ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•„ë˜ ì‚¬í•­ì„ ë¯¸ë¦¬ ì„¤ì •í•©ë‹ˆë‹¤:
   - **í˜¸ìŠ¤íŠ¸ ì´ë¦„:** `kws-pi` (ì›í•˜ëŠ” ì´ë¦„)
   - **SSH í™œì„±í™”:** ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš© (ì²´í¬)
   - **ì‚¬ìš©ì ì´ë¦„ ë° ë¹„ë°€ë²ˆí˜¸:** `pi` / `raspberry` (ì›í•˜ëŠ” ê³„ì •)
   - **ë¬´ì„  LAN(Wi-Fi) ì„¤ì •:** ì‚¬ìš©í•  ê³µìœ ê¸° ì´ë¦„(SSID)ê³¼ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
5. SD ì¹´ë“œë¥¼ ë¼ì¦ˆë² ë¦¬íŒŒì´ 3 B+ì— ë„£ê³  ë¶€íŒ…í•©ë‹ˆë‹¤. (ì•½ 1~2ë¶„ ì†Œìš”)

---

## 2ë‹¨ê³„: í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° í•˜ë“œì›¨ì–´ ì„¸íŒ…

VNCë‚˜ SSH(Putty ë“±)ë¥¼ í†µí•´ ë¼ì¦ˆë² ë¦¬íŒŒì´ì— ì ‘ì†í•œ í›„, í„°ë¯¸ë„(Terminal)ì„ ì—´ê³  ìˆœì„œëŒ€ë¡œ ë³µì‚¬+ë¶™ì—¬ë„£ê¸° í•©ë‹ˆë‹¤.

### 1. ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ ë° í•„ìˆ˜ ì˜ì¡´ì„± ì„¤ì¹˜
```bash
sudo apt-get update
sudo apt-get install -y python3-pip python3-dev
sudo apt-get install -y libatlas-base-dev  # Numpy ê°€ì†ìš©
sudo apt-get install -y portaudio19-dev    # ë§ˆì´í¬ ì œì–´(PyAudio)ìš©
```

### 2. ë§ˆì´í¬ ì—°ê²° í™•ì¸
USB ë§ˆì´í¬(ë˜ëŠ” ì˜¤ë””ì˜¤ í–‡)ë¥¼ ê½‚ì€ ë’¤, ì¸ì‹ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
```bash
arecord -l
```
> ëª©ë¡ì— USB ì˜¤ë””ì˜¤ ë””ë°”ì´ìŠ¤ê°€ ë³´ì´ë©´ ì •ìƒì…ë‹ˆë‹¤. (ì¹´ë“œ ë²ˆí˜¸ì™€ ë””ë°”ì´ìŠ¤ ë²ˆí˜¸ë¥¼ ê¸°ì–µí•´ë‘ì„¸ìš”. ë³´í†µ `hw:1,0` í˜•ì‹ì…ë‹ˆë‹¤.)

---

## 3ë‹¨ê³„: ì„ë² ë””ë“œìš© TensorFlow ë° íŒ¨í‚¤ì§€ ì„¤ì¹˜

Python 3.7(Buster ê¸°ë³¸)ì— ë§ì¶° ì»¤ë®¤ë‹ˆí‹°ì—ì„œ ë¹Œë“œí•´ë‘” ARM v7(ë¼ì¦ˆë² ë¦¬íŒŒì´ 3ìš©) TensorFlow 1.15 ë²„ì „ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
# pip ìµœì‹ í™”
python3 -m pip install --upgrade pip

# ARMìš© TensorFlow 1.15 ë¯¸ë¦¬ ë¹Œë“œëœ Wheel íŒŒì¼ ë‹¤ìš´ë¡œë“œ ë° ì„¤ì¹˜
wget https://github.com/lhelontra/tensorflow-on-arm/releases/download/v1.15.0/tensorflow-1.15.0-cp37-none-linux_armv7l.whl
pip3 install tensorflow-1.15.0-cp37-none-linux_armv7l.whl

# ë§ˆì´í¬ ìŠ¤íŠ¸ë¦¬ë°ì„ ìœ„í•œ pyaudio ì„¤ì¹˜
pip3 install pyaudio
```

---

## 4ë‹¨ê³„: íŒŒì¼ ì „ì†¡ ë° ì‹¤í–‰

PCì—ì„œ ì™„ì„±ëœ KWS íŒŒì¼ë“¤ì„ ë¼ì¦ˆë² ë¦¬íŒŒì´ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì „ì†¡ ìˆ˜ë‹¨ìœ¼ë¡œëŠ” FileZilla, WinSCP, ë˜ëŠ” `scp` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

**ì „ì†¡í•´ì•¼ í•  í•µì‹¬ íŒŒì¼ 2ê°€ì§€:**
1. `work/ds_cnn.tflite` (91KB ëª¨ë¸ íŒŒì¼)
2. `pc_mic_test.py` (ìš°ë¦¬ê°€ PCì—ì„œ ì™„ì„±í•˜ê³  ìµœì í™”í•œ ì‹¤ì‹œê°„ ì¶”ë¡  ìŠ¤í¬ë¦½íŠ¸)

ë¼ì¦ˆë² ë¦¬íŒŒì´ì˜ ì ë‹¹í•œ í´ë”(ì˜ˆ: `/home/pi/KWS/`)ì— ë‘ íŒŒì¼ì„ ë„£ìŠµë‹ˆë‹¤.

### ğŸš€ ì‹¤ì‹œê°„ ì¶”ë¡  ì‹¤í–‰
ë¼ì¦ˆë² ë¦¬íŒŒì´ í„°ë¯¸ë„ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
```bash
# tflite ëª¨ë¸ ê²½ë¡œê°€ ìŠ¤í¬ë¦½íŠ¸ ë‚´ ê²½ë¡œ('./work/ds_cnn.tflite')ì™€ ë§ëŠ”ì§€ í™•ì¸
python3 pc_mic_test.py
```
> PCì—ì„œ ê²½í—˜í–ˆë˜ ê²ƒê³¼ ë˜‘ê°™ì´, 1~2ì´ˆì˜ ì´ˆê¸°í™” í›„ "yes"ì™€ "no"ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¹ ë¥´ê²Œ í¬ì°©í•´ ë‚¼ ê²ƒì…ë‹ˆë‹¤!

---

## (ì°¸ê³ ) ë§ˆì´í¬ ì—ëŸ¬ ë°œìƒ ì‹œ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
ë§Œì•½ `pc_mic_test.py` ì‹¤í–‰ ì‹œ `[Errno -9998] Invalid number of channels` ë˜ëŠ” `Default Input Device` ê´€ë ¨ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´, PyAudioì— í•˜ë“œì›¨ì–´ ë§ˆì´í¬ ë²ˆí˜¸ë¥¼ ì§ì ‘ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

`pc_mic_test.py` íŒŒì¼ ë‚´ì˜ ìŠ¤íŠ¸ë¦¬ë° ì„¸íŒ… ë¼ì¸ì— `input_device_index` ë¶€ë¶„ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

```python
# ìˆ˜ì • ì „
stream = p.open(format=pyaudio.paInt16, ... )

# ìˆ˜ì • í›„: input_device_index ì¶”ê°€ (arecord -l ë¡œ í™•ì¸í•œ ì¹´ë“œ ë²ˆí˜¸ê°€ 1ë²ˆì¼ ë•Œ)
stream = p.open(format=pyaudio.paInt16,
                channels=1,
                rate=SAMPLE_RATE,
                input=True,
                input_device_index=1,  # <--- ì´ ë¶€ë¶„ ì¶”ê°€ (ê¸°ê¸° í™˜ê²½ì— ë§ê²Œ ìˆ«ì ë³€ê²½)
                frames_per_buffer=CHUNK_SIZE)
```
